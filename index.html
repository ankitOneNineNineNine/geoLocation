<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <h2 class='location'>YOUR JOURNEY</h2>
    <button id='start'>Start the journey</button>
    <button id='stop'>Stop the journey</button>
    <h1>Start Location </h1>
    <p id='lat'></p>
    <p id='long'></p>
    <h2>Current Location</h2>
    <p id='clat'></p>
    <p id='clong'></p>
    <h2>Parameters</h2>
    <p class='locDetails'>Distance = 0 Km</p>
    <p class='speed'>Speed = 0 Kmph</p>
    <script>
        var time = 0;
        var locs = [];
        var watchId;
        var timeInt;
        function watchLocation() {
            watchId = navigator.geolocation.watchPosition(pos => {
                document.getElementById('clat').textContent = 'latitude ' + pos.coords.latitude
                document.getElementById('clong').textContent = 'longitude ' + pos.coords.longitude
                if (locs.indexOf({
                    lat: pos.coords.latitude,
                    long: pos.coords.longitude
                }) < 0) {
                    locs.push({
                        lat: pos.coords.latitude,
                        long: pos.coords.longitude
                    })
                }
                let dist = distance(locs[0].lat, locs[0].long, locs[locs.length - 1].lat, locs[locs.length - 1].long)
                if (dist > 0) {
                    document.querySelector('.locDetails').textContent = `Distance = ${dist} Km`
                }
                if (time > 0) {
                    document.querySelector('.speed').textContent = `Speed = ${dist / (time / (3600))} Kmph`
                }

            }, err => {
                console.log('err', err)
            }, { maximumAge: 300000, timeout: 5000, enableHighAccuracy: true });
        }
        function distance(lat1, lon1, lat2, lon2,) {
            if ((lat1 == lat2) && (lon1 == lon2)) {
                return 0;
            }
            else {
                var radlat1 = Math.PI * lat1 / 180;
                var radlat2 = Math.PI * lat2 / 180;
                var theta = lon1 - lon2;
                var radtheta = Math.PI * theta / 180;
                var dist = Math.sin(radlat1) * Math.sin(radlat2) + Math.cos(radlat1) * Math.cos(radlat2) * Math.cos(radtheta);
                if (dist > 1) {
                    dist = 1;
                }
                dist = Math.acos(dist);
                dist = dist * 180 / Math.PI;
                dist = dist * 60 * 1.1515;
                dist = dist * 1.609344

                return dist;
            }
        }

        function getLocation() {
            return new Promise((res, rej) => {
                navigator.geolocation.getCurrentPosition(pos => {
                    document.getElementById('lat').textContent = 'latitude ' + pos.coords.latitude
                    document.getElementById('long').textContent = 'longitude ' + pos.coords.longitude
                    locs.push({
                        lat: pos.coords.latitude,
                        long: pos.coords.longitude
                    })
                    res(pos)
                }, err => {
                    rej(err)
                })

            })
        }
        document.getElementById('start').addEventListener('click', () => {
            document.getElementById('lat').textContent = 'WAITING.....'
            document.getElementById('long').textContent = 'WAITING.....'
            getLocation()
                .then(pos => {
                    watchLocation();
                    timeInt = setInterval(() => {
                        time += 1;
                    }, 1000)
                })
                .catch(err => {
                    console.log(err)
                });
        })
        document.getElementById('stop').addEventListener('click', () => {
            navigator.geolocation.clearWatch(watchId);
            clearInterval(timeInt)
        })


    </script>
</body>

</html>